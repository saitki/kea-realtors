---
import EmailIcon from "../icons/EmailIcon.astro";
import Logo from "../icons/Logo.astro";
import PhoneIcon from "../icons/PhoneIcon.astro";
import TablerMenu from "../icons/TablerMenu.astro";
import homeData from "../data/home.json";

const { header } = homeData.home;
---

<header class="header position-fixed top-0 w-100 z-3" id="mainHeader">
  <nav class="container-xxl px-4 py-3">
    <!-- TOP ROW -->
    <div
      class="d-flex align-items-center justify-content-between border-bottom p-1"
    >
      <!-- Logo izquierda -->
      <a class="header__logo" href="#">
        <Logo id={header.logo.id} src={header.logo.src} alt={header.logo.alt} />
      </a>
      <!-- NAVEGACIÓN CENTRADA (visible solo en scroll) -->
      <div class="header__navCentered">
        <ul class="d-flex gap-4 list-unstyled mb-0">
          {
            header.menu.map((item, index) => (
              <li>
                <a
                  href={item.href}
                  class={`headerMenu__link ${index === 0 ? "active" : ""}`}
                >
                  {item.label}
                </a>
              </li>
            ))
          }
        </ul>
      </div>
      <!-- Derecha: icons + menu -->
      <div class="d-flex align-items-center gap-4">
        <!-- Icons -->
        <ul class="d-flex gap-3 list-unstyled mb-0 header__icons">
          <li>
            <a href="tel:+5219981264494">
              <PhoneIcon />
            </a>
          </li>
          <li>
            <a href="mailto:sales@kearealtors.com">
              <EmailIcon />
            </a>
          </li>
          <li class="header__lang">ES</li>
          <li class="header__lang">EN</li>
        </ul>
        <!-- Menu toggle -->
        <button class="header__menuBtn" aria-label="Abrir menú">
          <TablerMenu />
        </button>
      </div>
    </div>
    <!-- BOTTOM ROW (navigation right) -->
    <div class="mt-3 header__navWrapper">
      <ul
        class="d-flex justify-content-end gap-4 list-unstyled mb-0 header__nav"
      >
        {
          header.menu.map((item, index) => (
            <li>
              <a
                href={item.href}
                class={`headerMenu__link ${index === 0 ? "active" : ""}`}
              >
                {item.label}
              </a>
            </li>
          ))
        }
      </ul>
    </div>
  </nav>
</header>

<script>
  const header = document.getElementById("mainHeader");
  const logo = document.getElementById("headerLogo");
  const phoneIcon = document.getElementById("phoneIcon");
  const emailIcon = document.getElementById("emailIcon");

  const logoWhite =
    "https://kearealtors.com/images/logos/kea-realtors-logo-white.webp";
  const logoGreen =
    "https://kearealtors.com/images/logos/kea-realtors-logo-green.webp";

  let lastScroll = 0;

  function updateHeaderState(isScrolled) {
    if (isScrolled) {
      // Estado scrolled (blanco con elementos negros)
      header?.classList.add("scrolled");

      // Cambiar logo a verde
      if (logo) logo.src = logoGreen;

      // Cambiar iconos a negro
      if (phoneIcon) {
        phoneIcon.setAttribute("fill", "#000");
        phoneIcon.setAttribute("stroke", "#000");
      }

      if (emailIcon) {
        emailIcon.setAttribute("fill", "#000");
      }

      // tablerMenu se maneja con CSS
    } else {
      // Estado inicial (transparente con elementos blancos)
      header?.classList.remove("scrolled");

      // Cambiar logo a blanco
      if (logo) logo.src = logoWhite;

      // Cambiar iconos a blanco
      if (phoneIcon) {
        phoneIcon.setAttribute("fill", "#fff");
        phoneIcon.setAttribute("stroke", "#fff");
      }

      if (emailIcon) {
        emailIcon.setAttribute("fill", "#fff");
      }

      // tablerMenu se maneja con CSS
    }
  }

  window.addEventListener("scroll", () => {
    const currentScroll = window.pageYOffset;
    updateHeaderState(currentScroll > 50);
    lastScroll = currentScroll;
  });
</script>
